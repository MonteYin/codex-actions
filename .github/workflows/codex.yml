name: Codex Automation

on:
  pull_request:
    types: [opened, synchronize, reopened, ready_for_review]
  issues:
    types: [opened]
  issue_comment:
    types: [created]
  pull_request_review_comment:
    types: [created]
  schedule:
    - cron: '0 0 * * *'
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write
  issues: write

jobs:
  # PR Review - AI code review with inline comments
  pr-review:
    if: github.event_name == 'pull_request'
    uses: ./.github/workflows/reusable-pr-review.yml
    secrets: inherit

  # PR Label - Auto-label PRs based on content
  pr-label:
    if: github.event_name == 'pull_request' && github.event.action == 'opened'
    uses: ./.github/workflows/reusable-pr-label.yml
    secrets: inherit

  # PR Description - Auto-enhance PR descriptions
  pr-description:
    if: github.event_name == 'pull_request' && github.event.action == 'opened'
    uses: ./.github/workflows/reusable-pr-description.yml
    secrets: inherit

  # Issue Label + Issue Dedupe - Classification and duplicate detection
  issue-triage:
    if: github.event_name == 'issues'
    uses: ./.github/workflows/reusable-issue-triage.yml
    with:
      enable_dedupe: true
    secrets: inherit

  # Issue Response - Auto-respond to new issues
  issue-response:
    if: github.event_name == 'issues'
    uses: ./.github/workflows/reusable-issue-auto-response.yml
    secrets: inherit

  # Mention Response - Respond to @codex mentions
  mention-response:
    if: |
      (github.event_name == 'issue_comment' || github.event_name == 'pull_request_review_comment') &&
      contains(github.event.comment.body, '@codex')
    uses: ./.github/workflows/reusable-mention-responder.yml
    secrets: inherit

  # Issue Stale Cleanup - Clean up inactive issues
  issue-stale-cleanup:
    if: github.event_name == 'schedule' || github.event_name == 'workflow_dispatch'
    uses: ./.github/workflows/reusable-issue-stale-cleanup.yml
    secrets: inherit
